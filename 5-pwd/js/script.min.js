"use strict";function AjaxCon(e,t,n,i){var r=4,a=this.getXHR();a.onreadystatechange=function(){a.readyState===r&&(a.status>=200&&a.status<300||304===a.status||400===a.status?t(a.responseText):console.log("Läsfel, status: "+a.status))},"get"===n||"GET"===n?(a.open("get",e,!0),a.send(null)):(a.open("POST",e,!0),a.setRequestHeader("Content-Type","application/json; charset=UTF-8"),a.send(i)),this.abort=function(){a.abort()}}function AppLoader(e){var t=document.createElement("div");t.classList.add("AppLoader");var n=document.createElement("h1");n.innerHTML=e,t.appendChild(n);var i=document.querySelector("body");i.appendChild(t);var r=document.createElement("div");r.classList.add("container"),t.appendChild(r);var a=document.createElement("div");a.classList.add("progress"),r.appendChild(a),setTimeout(function(){a.classList.add("loading"),setTimeout(function(){i.removeChild(t)},1250)},200)}function Message(e,t,n){this.getText=function(){return e},this.setText=function(t){e=t},this.getDate=function(){return t},this.setDate=function(e){t=e},this.getAuthor=function(){return n},this.setAuthor=function(e){n=e}}function MessageBoard(e,t,n){this.WindowConstruct("Chat",!1,e,t,n),this.title="Chat",this.app.classList.add("labbymezzage"),this.messages=[],this.imageLocation="images/chat",this.timer=void 0;var i=this.getCookie();"object"==typeof i?(this.refreshRate=i[0],this.username=i[1],this.history=i[2]):(this.refreshRate=1e4,this.username="Anonymous",this.history=20),this.connection=void 0,this.CreateHTMLLayout(),this.getMessagesFromServer()}function Desktop(e){this.windows=[],this.minimizedApps=0,this.element=document.getElementById(e),this.element.classList.add("desktop"),this.navbar=document.createElement("nav");var t=this,n=function(){var e=30*t.windows.length+30;return e/(window.innerWidth-200)>1?e-Math.floor(e/(window.innerWidth-200))*(window.innerWidth-200):30*t.windows.length+30},i=function(){var e=30*t.windows.length+30;return e/(window.innerHeight-300)>1?e-Math.floor(e/(window.innerHeight-300))*(window.innerHeight-300):30*t.windows.length+30};this.element.appendChild(this.navbar);var r=[[MemoryGame,"images/appIcons/Memory_Large.png","Memory"],[Minesweeper,"images/appIcons/Minesweeper_Large.png","Minesweeper"],[QuizWindow,"images/appIcons/Quiz_Large.png","Quiz"],[QuoteWindow,"images/appIcons/Quote_Large.png","Quotes"],[MessageBoard,"images/appIcons/Chat_Large.png","Chat"],[RSSWindow,"images/appIcons/RSS_Large.png","RSS"],[GalleryWindow,"images/appIcons/Gallery_Large.png","Gallery"],[NoteWindow,"images/appIcons/Note_Large.png","Note"]];r.forEach(function(e){var r=document.createElement("a");r.href="#",r.classList.add("appLauncher"),r.onclick=function(r){r.preventDefault(),t.windows.push(new e[0](t,n(),i()))};var a=document.createElement("img");a.src=e[1],r.appendChild(a);var s=document.createElement("span");s.innerHTML=e[2],r.appendChild(s),t.element.appendChild(r)}),this.hideApp=function(e,n){t.navbar.classList.add("showNav"),e=e.parentNode.parentNode,e.classList.add("hidden"),t.minimizedApps++;var i=document.createElement("img");i.src=n,i.className="minimizedWindow",i.onclick=function(){e.classList.remove("hidden"),t.navbar.removeChild(i),--t.minimizedApps<=0&&t.navbar.classList.remove("showNav")},t.navbar.appendChild(i)}}function ImageWindow(e,t,n,i){var r=document.createElement("img");r.src=e,this.WindowConstruct("Gallery",!1,t,n,i),this.app.appendChild(r)}function GalleryWindow(e,t,n){this.WindowConstruct("Gallery",!1,e,t,n),this.Url="http://homepage.lnu.se/staff/tstjo/labbyServer/imgviewer/",this.thumbWidth=0,this.thumbHeight=0,this.timer=void 0,this.imageArr=void 0,this.app.classList.add("Gallery"),this.OpenInNewWindow=function(i){new ImageWindow(i,e,t+5,n+5)},this.loadImages()}function MemoryGame(e,t,n){var i=2,r=4;this.WindowConstruct("Memory",!1,e,t,n),this.app.classList.add("GameOn-Memory"),this.imageLocation="images/memory/",this.getRows=function(){return i},this.setRows=function(e){i=e},this.getCols=function(){return r},this.setCols=function(e){r=e},this.isActive=!1,this.flippedImage,this.pictureArray,this.structuredArray,this.flippedCards,this.turnCounter,this.resetGame([this.getRows(),this.getCols()])}function Minesweeper(e,t,n){this.difficulties=[["Beginner",9],["Intermidiate",15],["Expert",20]],this.WindowConstruct("Minesweeper",!1,e,t,n),this.app.classList.add("GameOn-Minesweeper"),this.imagePrefix="images/minesweeper/",this.GameWidth=9,this.PictureWidth=20,this.gameOver,this.board=[],this.numberOfMines,this.mines,this.turnedImages,this.markedImages,this.timer,this.clock,this.bombsCounter,this.startGame()}function NoteWindow(e,t,n){this.startHeight=300,this.startWidth=300,this.WindowConstruct("Note",!0,e,t,n),this.render()}function QuizWindow(e,t,n){this.WindowConstruct("Quiz",!1,e,t,n),this.app=this.app,this.nextURL,this.moreQuestions=!0,this.questionsArr,this.init()}function QuoteWindow(e,t,n){this.WindowConstruct("Quote",!1,e,t,n),this.timer,this.connection,this.refreshRate=1e4,this.render()}function RSSWindow(e,t,n){this.startHeight=600,this.startWidth=300,this.WindowConstruct("RSS",!0,e,t,n),this.feedUrl="http://www.dn.se/m/rss/senaste-nytt",this.feed=void 0,this.timer=void 0,this.connection=void 0,this.refreshRate=6e5,this.reloadFeed(),this.render()}function Window(){this.dragY=0,this.dragX=0,this.dragging=!1,this.imageFolder="images/"}AjaxCon.prototype.getXHR=function(){var e=null;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){throw new Error("No XHR object available")}}return e},Message.prototype.getHTMLText=function(){return this.getText()},Message.prototype.getDateText=function(){var e=new Date,t=e-this.getDate(),n=Math.round(t/1e3),i=Math.floor(n/60),r=(Math.floor(i/60),e.getUTCDate()-this.getDate().getUTCDate()),a=e.getUTCMonth()-this.getDate().getUTCMonth(),s=this.getDate().getHours()+":"+(this.getDate().getMinutes()<10?"0":"")+this.getDate().getMinutes()+":"+(this.getDate().getSeconds()<10?"0":"")+this.getDate().getSeconds();return 60>n&&1>a?"just now":1==i&&0===a?i+" minute ago":60>i&&0===a?i+" minutes ago":1>r&&0===a?"Today "+s:2>r&&0===a?"Yesterday "+s:this.getDate().getUTCDate()+"/"+(this.getDate().getMonth()+1)+"-"+this.getDate().getFullYear()},MessageBoard.prototype=new Window,MessageBoard.prototype.constructor=MessageBoard,MessageBoard.prototype.ClearTimers=function(){clearInterval(this.timer),"undefined"!=typeof this.connection&&this.connection.abort()},MessageBoard.prototype.CreateHTMLLayout=function(){var e=this,t=document.createElement("div");t.className="labbyMezzageArea",this.app.appendChild(t);var n=document.createElement("div");n.className="labbyMezzageCount",this.app.appendChild(n);var i=document.createElement("textarea");i.className="labbyMezzageContent",i.onkeypress=function(t){13==t.keyCode&&(t.shiftKey||(t.preventDefault(),e.addMessage()))},this.app.appendChild(i);var r=document.createElement("button");r.className="submitBtn";var a=document.createTextNode("Send");r.appendChild(a),this.app.appendChild(r),r.onclick=function(){e.addMessage(),e.app.getElementsByClassName("labbyMezzageContent")[0].focus()}},MessageBoard.prototype.numberOfMessages=function(){return this.messages.length+" messages"},MessageBoard.prototype.renderMessage=function(e){var t=document.createElement("section"),n=document.createElement("p");n.innerHTML="Skrivet av: "+e.getAuthor(),t.appendChild(n);var i=document.createElement("p");i.innerHTML=e.getHTMLText(),t.appendChild(i);var r=document.createElement("date");return r.innerHTML=e.getDateText(),t.appendChild(r),t},MessageBoard.prototype.getMessagesFromServer=function(){var e,t=this,n=function(n){clearTimeout(e);var i;if(t.messages=[],"undefined"!=typeof window.DOMParser)i=function(e){return(new window.DOMParser).parseFromString(e,"text/xml")};else{if("undefined"==typeof window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))throw new Error("No XML parser found");i=function(e){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}}t.setStatus("Messages received");for(var r=i(n),a=r.getElementsByTagName("message"),s=0;s<a.length;s++){{var o=a[s],d=o.querySelector("text").innerHTML,c=o.querySelector("time").innerHTML,p=o.querySelector("author").innerHTML;o.querySelector("id").innerHTML}t.messages.push(new Message(d,new Date(parseInt(c)),p))}t.renderMessages()};t.setStatus("Retrieving messages"),e=setTimeout(function(){t.setStatus("Laddar meddelanden...<img src='images/loader_white.gif'>")},100);var i=void 0!==t.history?"?history="+t.history:"";t.connection=new AjaxCon("http://homepage.lnu.se/staff/tstjo/labbyserver/getMessage.php"+i,n,"GET"),this.timer=setInterval(function(){e=setTimeout(function(){t.setStatus("Laddar meddelanden...<img src='images/loader_white.gif'>")},100),t.connection=new AjaxCon("http://homepage.lnu.se/staff/tstjo/labbyserver/getMessage.php"+i,n,"GET")},t.refreshRate)},MessageBoard.prototype.renderMessages=function(){var e=this.app.getElementsByClassName("labbyMezzageArea")[0],t=this.app.getElementsByClassName("labbyMezzageCount")[0];e.innerHTML="";var n=0,i=this;this.messages.forEach(function(t){e.appendChild(i.renderMessage(t,n)),n++}),t.innerHTML=this.numberOfMessages(),this.scrollToBottom()},MessageBoard.prototype.scrollToBottom=function(){var e=this.app.getElementsByClassName("labbyMezzageArea")[0];e.scrollTop=e.scrollHeight},MessageBoard.prototype.addMessage=function(){var e=this,t=this.app.getElementsByClassName("labbyMezzageContent")[0],n=function(n){console.log(n),t.value="",e.ClearTimers(),e.getMessagesFromServer(),e.scrollToBottom()};""!=t.value&&$.ajax({type:"POST",url:"http://homepage.lnu.se/staff/tstjo/labbyserver/setMessage.php",data:{username:e.username,text:t.value},success:n})},MessageBoard.prototype.contextMenu=function(){var e=this,t=document.createElement("ul");t.dataset.name="Settings";var n=document.createElement("li"),i=document.createElement("a");return i.href="#",i.innerHTML="<img src='images/user.png'> Nickname",i.onclick=function(t){t.preventDefault(),e.getNickSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement("li"),i=document.createElement("a"),i.href="#",i.innerHTML="<img src='images/interval.png'> Time interval",i.onclick=function(t){t.preventDefault(),e.getIntervalSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement("li"),i=document.createElement("a"),i.href="#",i.innerHTML="<img src='images/messages.png'> Number of messages",i.onclick=function(t){t.preventDefault(),e.getHistorySetting()},n.appendChild(i),t.appendChild(n),n=document.createElement("li"),i=document.createElement("a"),i.href="#",i.innerHTML="<img src='images/refresh.png'> Refresh",i.onclick=function(t){t.preventDefault(),e.ClearTimers(),e.getMessagesFromServer()},n.appendChild(i),t.appendChild(n),[t]},MessageBoard.prototype.getIntervalSetting=function(){var e=this,t=document.createElement("div");t.classList.add("popup");var n=document.createElement("a");n.href="#";var i=document.createElement("img");i.src="images/closewindow.png",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement("select"),a=[[1e4,"10 sekunder"],[15e3,"15 sekunder"],[3e4,"30 sekunder"],[6e4,"1 minut"],[3e5,"5 minuter"],[6e5,"10 minuter"]];r.innerHTML="",a.forEach(function(t){var n=t[0]==e.refreshRate?" selected":"";r.innerHTML+="<option value='"+t[0]+"'"+n+">"+t[1]+"</option>"}),r.innerHTML+="<option value='15000'>15 sekunder</option>",t.appendChild(r);var s=document.createElement("button");s.innerHTML="Ändra",s.onclick=function(){e.ClearTimers(),e.refreshRate=r.value,e.createCookie(),e.getMessagesFromServer(),e.app.parentNode.removeChild(t)},t.appendChild(s),this.app.parentNode.appendChild(t)},MessageBoard.prototype.getHistorySetting=function(){var e=this,t=document.createElement("div");t.classList.add("popup");var n=document.createElement("a");n.href="#";var i=document.createElement("img");i.src="images/closewindow.png",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement("select"),a=[[5,"5 meddelanden"],[10,"10 meddelanden"],[20,"20 meddelanden"],[50,"50  meddelanden"],[void 0,"Alla  meddelanden"]];r.innerHTML="",a.forEach(function(t){var n=t[0]==e.history?" selected":"";r.innerHTML+="<option value='"+t[0]+"'"+n+">"+t[1]+"</option>"}),t.appendChild(r);var s=document.createElement("button");s.innerHTML="Ändra",s.onclick=function(){e.ClearTimers(),e.history=r.value,e.createCookie(),e.getMessagesFromServer(),e.app.parentNode.removeChild(t)},t.appendChild(s),this.app.parentNode.appendChild(t)},MessageBoard.prototype.getNickSetting=function(){var e=this,t=document.createElement("div");t.classList.add("popup");var n=document.createElement("a");n.href="#";var i=document.createElement("img");i.src="images/closewindow.png",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.parentNode.removeChild(t)},t.appendChild(n);var r=document.createElement("input");r.type="text",r.value=e.username,t.appendChild(r);var a=document.createElement("button");a.innerHTML="Ändra",a.onclick=function(){e.username=r.value,e.createCookie(),e.app.parentNode.removeChild(t)},t.appendChild(a),this.app.parentNode.appendChild(t),r.focus(),r.select()},MessageBoard.prototype.createCookie=function(){var e,t="setting",n=this.refreshRate+","+this.username+","+this.history,i=1;if(i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),e="; expires="+r.toGMTString()}else e="";document.cookie=t+"="+n+e+"; path=/"},MessageBoard.prototype.getCookie=function(){var e="setting";if(document.cookie.length>0){var t=document.cookie.indexOf(e+"=");if(-1!=t){t=t+e.length+1;var n=document.cookie.indexOf(";",t);return-1==n&&(n=document.cookie.length),decodeURI(document.cookie.substring(t,n)).split(",")}}return""},ImageWindow.prototype=new Window,ImageWindow.prototype.constructor=ImageWindow,GalleryWindow.prototype=new Window,GalleryWindow.prototype.constructor=GalleryWindow,GalleryWindow.prototype.render=function(){var e=this;this.imageArr.forEach(function(t){var n=document.createElement("a");n.href="#",n.style.width=e.thumbWidth+"px",n.style.height=e.thumbHeight+"px",n.classList.add("imageContainer"),n.onclick=function(n){n.preventDefault(),e.OpenInNewWindow(t.URL)},n.onmouseover=function(){e.setStatus("Bildstorlek: "+t.width+"px X "+t.height+"px")},n.onmouseleave=function(){e.setStatus("")};var i=document.createElement("img");i.src=t.thumbURL,n.appendChild(i),e.app.appendChild(n)})},GalleryWindow.prototype.loadImages=function(){var e,t=this,n=function(n){clearTimeout(e),t.setStatus("Bilder laddade!"),t.imageArr=JSON.parse(n);for(var i=0;i<t.imageArr.length;i++)t.imageArr[i].thumbWidth>t.thumbWidth&&(t.thumbWidth=t.imageArr[i].thumbWidth),t.imageArr[i].thumbHeight>t.thumbHeight&&(t.thumbHeight=t.imageArr[i].thumbHeight);t.render()};t.setStatus("Laddar bilder..."),e=setTimeout(function(){t.setStatus("Laddar bilder...<img src='images/loader_white.gif'>")},1500),new AjaxCon(this.Url,n,"GET")},MemoryGame.prototype=new Window,MemoryGame.prototype.constructor=MemoryGame,MemoryGame.prototype.resetGame=function(e){var t={getPictureArray:function(e,t){for(var n=e*t,i=n/2,r=[],a=0;n>a;a++)r[a]=0;for(var s=1;i>=s;s++){var o=!1,d=!1;do{if(0==o){var c=Math.floor(Math.random()*(e*t-0)+0);0==r[c]&&(r[c]=s,o=!0)}if(0==d){var p=Math.floor(Math.random()*(e*t-0)+0);0==r[p]&&(r[p]=s,d=!0)}}while(0==o||0==d)}return r}};void 0!==e[0]&&this.setRows(e[0]),void 0!==e[1]&&this.setCols(e[1]),this.app.innerHTML="",this.pictureArray=t.getPictureArray(this.getRows(),this.getCols()),this.structuredArray=this.getStructuredArray(),this.flippedImage=void 0,this.flippedCards=[],this.turnCounter=0,this.renderBoard()},MemoryGame.prototype.renderBoard=function(){var e,t,n,i=this;this.structuredArray.forEach(function(r){e=document.createElement("div"),e.className="row",r.forEach(function(r){t=document.createElement("a"),t.href="#",n=document.createElement("img"),n.src=i.imageLocation+"0.png",t.appendChild(n),t.onclick=function(e){e.preventDefault(),i.isActive===!1&&0!==i.flippedCards.indexOf(r.value)&&i.flipCards(this,r)},e.appendChild(t)}),i.app.appendChild(e)})},MemoryGame.prototype.getStructuredArray=function(){var e,t,n=[];for(e=0;e<this.getRows();e++)for(n[e]=[],t=0;t<this.getCols();t++)n[e][t]=[],n[e][t].value=this.pictureArray[this.getCols()*e+t],n[e][t].id=this.getCols()*e+t;return n},MemoryGame.prototype.getSettings=function(e,t){var n=document.createElement("div");n.className="overlay";var i=document.createElement("h1");i.innerHTML=e,n.appendChild(i);var r=document.createElement("p");r.innerHTML=t,n.appendChild(r);var a=document.createElement("button");a.innerHTML="Starta spel";var s=this;a.onclick=function(){s.resetGame([s.getRows(),s.getCols()])},n.appendChild(a),this.app.appendChild(n)},MemoryGame.prototype.flipCards=function(e,t){var n;n=e.firstChild;var i=this;i.isActive=!0,n.className="flipped",setTimeout(function(){n.src=i.imageLocation+t.value+".png",void 0===i.flippedImage?(i.flippedImage=[],i.flippedImage.element=n,i.flippedImage.value=t.value,i.isActive=!1):(i.isActive=!0,i.flippedImage.element!=n&&i.flippedImage.value===t.value?(i.turnCounter++,i.flippedCards.push(t.value),i.flippedCards.length>=i.pictureArray.length/2&&i.getSettings("Grattis!","Du klarade av spelet på "+i.turnCounter+" omgångar, vill du spela igen?"),i.flippedImage=void 0,i.isActive=!1):i.flippedImage.element===n?i.isActive=!1:(i.turnCounter++,setTimeout(function(){var e=[n,i.flippedImage.element];e.forEach(function(e){e.className="",setTimeout(function(){e.src=i.imageLocation+"0.png"},125)}),i.flippedImage=void 0,i.isActive=!1},500)))},125)},MemoryGame.prototype.contextMenu=function(){var e=this,t=document.createElement("ul");t.dataset.name="Options";var n=document.createElement("li"),i=document.createElement("a");i.href="#",i.innerHTML="<img src='images/refresh.png'> Reset",i.onclick=function(t){t.preventDefault(),e.resetGame([e.getRows(),e.getCols()])},n.appendChild(i),t.appendChild(n);var r=document.createElement("ul"),a=[[1,4],[2,4],[3,4],[4,4]];return r.dataset.name="Difficulties",a.forEach(function(t){n=document.createElement("li"),i=document.createElement("a"),i.href="#",i.innerHTML="<img src='images/tiles.png'> "+t[0]+"x"+t[1],i.onclick=function(n){n.preventDefault(),e.resetGame(t)},n.appendChild(i),r.appendChild(n)}),[t,r]},Minesweeper.prototype=new Window,Minesweeper.prototype.constructor=Minesweeper,Minesweeper.prototype.ClearTimers=function(){clearInterval(this.timer)},Minesweeper.prototype.startGame=function(){this.setDefaultValues(),this.drawGame(),this.calculateMines()},Minesweeper.prototype.resetGame=function(){this.resetAllTiles(),this.setDefaultValues(),this.bombsCounter.innerHTML=this.numberOfMines,this.calculateMines(),this.startTimer()},Minesweeper.prototype.setDefaultValues=function(){this.gameOver=!1,this.numberOfMines=Math.floor(this.GameWidth*this.GameWidth*.25),this.mines=[],this.turnedImages=0,this.markedImages=0},Minesweeper.prototype.drawGame=function(){function e(e){if(e.preventDefault(),n.gameOver===!1){var t=Math.floor((e.pageX-this.getBoundingClientRect().left)/n.PictureWidth),i=Math.floor((e.pageY-this.getBoundingClientRect().top)/n.PictureWidth);n.isTurned(i,t)===!1&&(3===e.which?n.isMarked(i,t)===!1?n.setMarker(i,t):n.isMarked(i,t)===!0&&n.removeMarker(i,t):n.hasMine(i,t)?(n.mines.forEach(function(e){n.setImage(e[0],e[1],n.imagePrefix+"bomb.png")}),n.setImage(i,t,n.imagePrefix+"bombred.png"),clearTimeout(n.timer),n.gameOver=!0):n.showEmptyTiles(i,t),n.bombsCounter.innerHTML=n.numberOfMines-n.markedImages,n.markedImages+n.turnedImages>=n.GameWidth*n.GameWidth&&n.markedImages===n.numberOfMines&&(alert("Congratz! You won!"),clearTimeout(n.timer),n.gameOver=!0))}}var t,n=this;n.app.innerHTML="";var i=document.createElement("div");this.app.style.width=this.GameWidth*this.PictureWidth+"px",i.style.width=this.GameWidth*this.PictureWidth+"px",i.onclick=e,i.addEventListener("contextmenu",e);var r=document.createElement("header"),a=document.createElement("button");for(a.innerHTML="New Game",a.onclick=function(){n.resetGame()},this.bombsCounter=document.createElement("div"),this.bombsCounter.className="bombsLeft",this.bombsCounter.innerHTML=this.numberOfMines,this.clock=document.createElement("div"),this.clock.className="timer",this.startTimer(),r.appendChild(this.bombsCounter),r.appendChild(a),r.appendChild(this.clock),this.app.appendChild(r),this.app.appendChild(i),this.board=[],t=0;t<this.GameWidth;t++){var s=document.createElement("div");s.className="row";for(var o=[],d=0;d<this.GameWidth;d++){var c=document.createElement("img");c.src=this.imagePrefix+"standard.png",s.appendChild(c),o.push({image:c,mine:!1,turned:!1,marked:!1})}this.board.push({rowDiv:s,rowArray:o}),i.appendChild(s)}},Minesweeper.prototype.resetAllTiles=function(){var e,t,n=this;for(e=0;e<this.GameWidth;e++)for(var t=0;t<this.GameWidth;t++){var i=this.board[e].rowArray[t];i.mine=!1,i.turned=!1,i.marked=!1,i.image.src.split("/").indexOf("standard.png")<0&&(i.image.src=n.imagePrefix+"standard.png")}},Minesweeper.prototype.calculateMines=function(){for(var e=0;e<this.numberOfMines;e++){var t=Math.floor(Math.random()*this.GameWidth),n=Math.floor(Math.random()*this.GameWidth);this.hasMine(t,n)===!1?(this.setMine(t,n),this.mines.push([t,n])):e--}},Minesweeper.prototype.startTimer=function(){clearTimeout(this.timer);var e=this;this.clock.innerHTML=0;var t=1;this.timer=setInterval(function(){e.clock.innerHTML=t,t++},1e3)},Minesweeper.prototype.contextMenu=function(){var e=this,t=document.createElement("ul");return t.dataset.name="Difficulties",e.difficulties.forEach(function(n){var i=document.createElement("li"),r=document.createElement("a");r.href="#",r.innerHTML=n[0],r.onclick=function(){e.GameWidth=n[1],e.startGame()},i.appendChild(r),t.appendChild(i)}),[t]},Minesweeper.prototype.showEmptyTiles=function(e,t){if(!(e>=this.GameWidth||0>e||t>=this.GameWidth||0>t||this.isTurned(e,t)===!0||this.hasMine(e,t))){if(this.turnImage(e,t),this.turnedImages++,this.hasNeighborMines(e,t)>0)return void this.setImage(e,t,this.imagePrefix+this.hasNeighborMines(e,t)+".png");this.setImage(e,t,this.imagePrefix+"empty.png"),this.showEmptyTiles(e-1,t),this.showEmptyTiles(e-1,t+1),this.showEmptyTiles(e-1,t-1),this.showEmptyTiles(e+1,t),this.showEmptyTiles(e+1,t+1),this.showEmptyTiles(e+1,t-1),this.showEmptyTiles(e,t-1),this.showEmptyTiles(e,t+1)}},Minesweeper.prototype.isMarked=function(e,t){return this.board[e].rowArray[t].marked},Minesweeper.prototype.setMarker=function(e,t){this.board[e].rowArray[t].marked=!0,this.markedImages<this.numberOfMines&&(this.markedImages++,this.setImage(e,t,this.imagePrefix+"marked.png"))},Minesweeper.prototype.removeMarker=function(e,t){this.board[e].rowArray[t].marked=!1,this.markedImages>0&&(this.markedImages--,this.setImage(e,t,this.imagePrefix+"standard.png"))},Minesweeper.prototype.hasMine=function(e,t){return this.board[e].rowArray[t].mine},Minesweeper.prototype.isTurned=function(e,t){return this.board[e].rowArray[t].turned},Minesweeper.prototype.turnImage=function(e,t){this.isMarked(e,t)&&this.removeMarker(e,t),this.board[e].rowArray[t].turned=!0},Minesweeper.prototype.setImage=function(e,t,n){this.board[e].rowArray[t].image.src=n},Minesweeper.prototype.setMine=function(e,t){this.board[e].rowArray[t].mine=!0},Minesweeper.prototype.hasNeighborMines=function(e,t){var n,i,r=0;for(n=e-1;e+1>=n;n++)for(i=t-1;t+1>=i;i++)n<this.GameWidth&&n>=0&&i<this.GameWidth&&i>=0&&this.hasMine(n,i)&&r++;return r},NoteWindow.prototype=new Window,NoteWindow.prototype.constructor=NoteWindow,NoteWindow.prototype.render=function(){var e=this;e.app.classList.add("Note");var t=document.createElement("textarea");e.app.parentNode.style.position="absolute",e.app.parentNode.style.right="0",e.app.parentNode.style.left="0",e.app.parentNode.style.top="0",e.app.parentNode.style.bottom="0",e.app.appendChild(t),t.focus()},QuizWindow.prototype=new Window,QuizWindow.prototype.constructor=QuizWindow,QuizWindow.prototype.getScore=function(){var e=this,t=this.app.querySelector(".workArea");t.innerHTML="";var n=document.createElement("div");n.className="questionList",t.appendChild(n);for(var i=0,r=0;r<this.questionsArr.length;r++){var a=document.createElement("section");a.className="result","Correct answer!"===this.questionsArr[r].response&&1===this.questionsArr[r].tries?(i++,a.classList.add("correct")):("Wrong answer! :("===this.questionsArr[r].response||this.questionsArr[r].tries>1)&&a.classList.add("incorrect");var s=document.createElement("header"),o=document.createElement("span");o.innerHTML=this.questionsArr[r].question,s.appendChild(o);var d=document.createElement("img");d.src="images/quiz/arrow.svg",d.alt="Arrow",(a.classList.contains("incorrect")||this.questionsArr[r].tries>1)&&(d.className="up"),s.appendChild(d);var c=document.createElement("a");c.href="#",c.appendChild(s),c.onclick=function(e){e.preventDefault();var t=this.parentNode.querySelector(".answer");t.classList.toggle("hidden"),this.parentNode.querySelector("img").classList.toggle("up")},a.appendChild(c);var p=document.createElement("section");p.classList.add("answer"),a.classList.contains("incorrect")||1!=this.questionsArr[r].tries||p.classList.add("hidden"),p.innerHTML="Du svarade: "+this.questionsArr[r].answer,this.questionsArr[r].tries>1&&(p.innerHTML+=" efter "+this.questionsArr[r].tries+" försök"),a.appendChild(p),n.appendChild(a)}var l=document.createElement("div");l.innerHTML="Du fick "+i+" av "+this.questionsArr.length+" rätt!",l.className="totalScore",t.appendChild(l);var u=document.createElement("button");u.innerHTML="Ny omgång",u.className="btn newGame",u.onclick=function(){e.init()},t.appendChild(u)},QuizWindow.prototype.disableInput=function(){var e=this.app.querySelector(".sendAnswer"),t=this.app.querySelector(".answerBox");t.readOnly=!0,e.disabled=!0},QuizWindow.prototype.enableInput=function(){var e=this.app.querySelector(".sendAnswer"),t=this.app.querySelector(".answerBox");t.readOnly=!1,e.disabled=!1},QuizWindow.prototype.getQuestion=function(e){var t=this,n=function(e){var n=JSON.parse(e);t.nextURL=n.nextURL;var i=t.app.querySelector(".questionField");i.classList.toggle("opacity-0"),setTimeout(function(){i.innerHTML=n.question,i.classList.toggle("opacity-0")},250),t.addQuestion(n.question),t.enableInput(),t.setStatus("Waiting on input...")};t.setStatus("Waiting on question from server"),new AjaxCon(e,n,"GET")},QuizWindow.prototype.sendAnswer=function(e){var t=this;t.addAnswer(e);var n=function(e){var n=JSON.parse(e);t.addResponse(n.message),void 0!=n.nextURL?t.getQuestion(n.nextURL):"Wrong answer! :("===n.message?(t.enableInput(),t.addFailure(),t.setStatus("Waiting on input...")):(t.gameOver(),t.setStatus("No more questions!"))},i=this.nextURL;this.setStatus("Sending answer to server"),new AjaxCon(i,n,"POST",JSON.stringify({answer:e}))},QuizWindow.prototype.init=function(){this.questionsArr=[],this.render(),this.getQuestion("http://vhost3.lnu.se:20080/question/1")},QuizWindow.prototype.gameOver=function(){this.getScore()},QuizWindow.prototype.render=function(){var e=this;this.app.innerHTML="",this.app.classList.add("thequiz");var t=document.createElement("div");t.className="workArea";var n=document.createElement("div");n.className="questionField",t.appendChild(n);var i=document.createElement("input");i.type="text",i.className="answerBox",t.appendChild(i);var r=document.createElement("button");r.className="sendAnswer",r.innerHTML="Skicka svar";var a=function(){""!=i.value&&(e.disableInput(),e.sendAnswer(i.value),i.value="")};r.onclick=a,i.onkeypress=function(e){13==e.keyCode&&a()},t.appendChild(r),this.app.appendChild(t)},QuizWindow.prototype.addAnswer=function(e){this.questionsArr[this.questionsArr.length-1].answer=e},QuizWindow.prototype.addResponse=function(e){this.questionsArr[this.questionsArr.length-1].response=e},QuizWindow.prototype.addQuestion=function(e){this.questionsArr.push({question:e,answer:void 0,response:void 0,tries:1})},QuizWindow.prototype.error=function(){this.app.innerHTML="<p>Någonting gick fel!</p><p>Testa att starta om applikationen</p>"},QuizWindow.prototype.addFailure=function(){this.questionsArr[this.questionsArr.length-1].tries++;var e=document.createElement("p");e.innerHTML="Fel svar, försök igen!",this.app.querySelector(".questionField").appendChild(e)},QuoteWindow.prototype=new Window,QuoteWindow.prototype.constructor=QuoteWindow,QuoteWindow.prototype.render=function(){var e=this;e.app.classList.add("Quote");var t,n=function(){var n=function(n){clearTimeout(t),e.setStatus("");var r=JSON.parse(n);if(e.app.innerHTML="","undefined"!=typeof r.Url){var a=document.createElement("img");a.src=r.Url,setTimeout(function(){a.classList.add("active"),setTimeout(function(){a.classList.remove("active")},e.refreshRate-500)},250),e.app.appendChild(a)}var s=document.createElement("blockquote");s.innerHTML=r.Quote.replace(/\r\n/g,"<br/><br/>"),e.app.appendChild(s),setTimeout(function(){s.classList.add("active"),setTimeout(function(){s.classList.remove("active")},e.refreshRate-500)},250);var o=document.createElement("cite");o.innerHTML=r.Author,s.appendChild(o),i()};e.setStatus("Loading quote from server..."),t=setTimeout(function(){e.setStatus("Laddar... <img src='images/loader_white.gif'/>")},300),e.connection=new AjaxCon("http://erikhamrin.se/projects/quotes.php",n,"GET")},i=function(){e.timer=setTimeout(n,e.refreshRate)};n()},QuoteWindow.prototype.ClearTimers=function(){console.log("QUOTE: Removing all timers"),clearTimeout(this.timer),console.log("QUOTE: Removing connection"),this.connection.abort()},RSSWindow.prototype=new Window,RSSWindow.prototype.constructor=RSSWindow,RSSWindow.prototype.reloadFeed=function(){var e=this,t=function(){var t=function(t){var n=new Date,i=n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),r=n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds();e.setStatus("Uppdaterad "+n.getHours()+":"+i+":"+r),e.feed.innerHTML=t};e.setStatus("Laddar RSS-flöde"),e.connection=new AjaxCon("http://homepage.lnu.se/staff/tstjo/labbyServer/rssproxy/?url="+encodeURI(e.feedUrl),t,"GET")};t(),this.timer=setInterval(t,e.refreshRate)},RSSWindow.prototype.render=function(){var e=this;e.app.className="RSSWindow",e.feed=document.createElement("article"),e.app.appendChild(e.feed)},RSSWindow.prototype.ClearTimers=function(){console.log("RSS: Removing all timers"),clearInterval(this.timer)},RSSWindow.prototype.contextMenu=function(){var e=this,t=document.createElement("ul");t.dataset.name="Settings";var n=document.createElement("li"),i=document.createElement("a");return i.href="#",i.innerHTML="<img src='images/interval.png'> Timer interval",i.onclick=function(t){t.preventDefault(),e.getIntervalSetting()},n.appendChild(i),t.appendChild(n),n=document.createElement("li"),i=document.createElement("a"),i.href="#",i.innerHTML="<img src='images/setting.png'> Select RSS-feed",i.onclick=function(t){t.preventDefault(),e.getRSSFeed()},n.appendChild(i),t.appendChild(n),n=document.createElement("li"),i=document.createElement("a"),i.href="#",i.innerHTML="<img src='images/refresh.png'> Refresh",i.onclick=function(t){t.preventDefault(),e.ClearTimers(),e.reloadFeed()},n.appendChild(i),t.appendChild(n),[t]},RSSWindow.prototype.getIntervalSetting=function(){var e=this,t=document.createElement("div");t.classList.add("popup");var n=document.createElement("a");n.href="#";var i=document.createElement("img");i.src="images/closewindow.png",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.removeChild(t)},t.appendChild(n);var r=document.createElement("select"),a=[[1e4,"10 sekunder"],[15e3,"15 sekunder"],[3e4,"30 sekunder"],[6e4,"1 minut"],[3e5,"5 minuter"],[6e5,"10 minuter"],[18e5,"30 minuter"]];r.innerHTML="",a.forEach(function(t){var n=t[0]==e.refreshRate?" selected":"";r.innerHTML+="<option value='"+t[0]+"'"+n+">"+t[1]+"</option>"}),t.appendChild(r);var s=document.createElement("button");
s.innerHTML="Ändra",s.onclick=function(){e.ClearTimers(),e.refreshRate=r.value,e.reloadFeed(),e.app.removeChild(t)},t.appendChild(s),this.app.appendChild(t)},RSSWindow.prototype.getRSSFeed=function(){var e=this,t=document.createElement("div");t.classList.add("popup");var n=document.createElement("a");n.href="#";var i=document.createElement("img");i.src="images/closewindow.png",n.appendChild(i),n.onclick=function(n){n.preventDefault(),e.app.removeChild(t)},t.appendChild(n);var r=document.createElement("div");r.classList.add("inputcontainer");var a=document.createElement("input");a.type="radio",a.name="rssRadio",a.value="http://www.dn.se/m/rss/senaste-nytt";var s=document.createTextNode("DN - Senaste nytt");r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement("div"),r.classList.add("inputcontainer"),a=document.createElement("input"),a.type="radio",a.name="rssRadio",a.value="http://www.dn.se/ledare/m/rss",s=document.createTextNode("DN - Ledare"),r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement("div"),r.classList.add("inputcontainer"),a=document.createElement("input"),a.type="radio",a.name="rssRadio",a.value="http://www.dn.se/ekonomi/m/rss/senaste-nytt",s=document.createTextNode("DN - Ekonomi"),r.appendChild(a),r.appendChild(s),t.appendChild(r),r=document.createElement("div"),r.classList.add("inputcontainer"),a=document.createElement("input"),a.type="radio",a.name="rssRadio",a.value="other",a.checked=!0,s=document.createTextNode("Annat: "),r.appendChild(a),r.appendChild(s),t.appendChild(r),a.onfocus=function(){o.focus(),o.select()};var o=document.createElement("input");o.type="text",o.value=e.feedUrl,r.appendChild(o);var d=document.createElement("button");d.innerHTML="Skicka",d.onclick=function(){var n=t.querySelector('input[name="rssRadio"]:checked').value;e.feedUrl="other"===n?o.value:n,e.ClearTimers(),e.reloadFeed(),e.app.removeChild(t)},t.appendChild(d),this.app.appendChild(t),o.focus(),o.select()},Window.prototype.focusWindow=function(){for(var e=document.querySelectorAll(".application"),t=0;t<e.length;t++)e[t].style.zIndex="1";this.style.zIndex="5"},Window.prototype.createHTML=function(){var e=this,t=document.createElement("div");t.classList.add("application"),t.style.left=this.xPos+"px",t.style.top=this.yPos+"px",t.style.zIndex="6",void 0!==this.startWidth&&(t.style.width=this.startWidth+"px"),void 0!==this.startHeight&&(t.style.height=this.startHeight+"px"),t.onmousedown=this.focusWindow;var n=document.createElement("header");n.classList.add("appHeader"),n.onmousedown=function(r){t.classList.contains("fullscreen")||r.target==s||r.target==o||r.target==d||(e.dragY=r.pageY-t.offsetTop,e.dragX=r.pageX-t.offsetLeft,n.style.cursor="move",e.dragging=!0,t.classList.add("dragging"),e.DisableSelection(e.desktop.element),n.addEventListener("mouseleave",i),n.addEventListener("mousemove",function(n){e.dragging&&(t.style.top=n.clientY-e.dragY+"px",t.style.left=n.clientX-e.dragX+"px")}))};var i=function(i){i.clientY-e.dragY+200>window.innerHeight?t.style.top=window.innerHeight-200+"px":i.clientY-e.dragY<0&&(t.style.top="20px"),i.clientX-e.dragX+200>window.innerWidth?t.style.left=window.innerWidth-200+"px":i.clientX-e.dragX<0&&(t.style.left="20px"),e.dragging=!1,t.classList.remove("dragging"),n.style.removeProperty("cursor"),e.EnableSelection(e.desktop.element)};n.onmouseup=i;var r=document.createElement("img");r.src=this.imageFolder+"appIcons/"+this.type+".png",r.alt="Icon",r.ondragstart=function(){return!1},r.classList.add("appIcon"),n.appendChild(r);var a=document.createElement("h2");a.innerHTML=this.type,n.appendChild(a);var s=document.createElement("img");s.classList.add("appController"),s.alt="Close window",s.src=this.imageFolder+"closewindow.png",s.onclick=function(){"function"==typeof e.ClearTimers&&e.ClearTimers(),document.querySelector("#desktopApplication").removeChild(t)},n.appendChild(s);var o=document.createElement("img");o.classList.add("appController"),o.alt="Fullscreen",o.src=this.imageFolder+"fullsize.png",o.onclick=function(){t.classList.contains("fullscreen")?(t.style.left=e.xPos+"px",t.style.top=e.yPos+"px",void 0!==e.startWidth&&(t.style.width=e.startWidth+"px"),void 0!==e.startHeight&&(t.style.height=e.startHeight+"px")):(e.xPos=t.offsetLeft,e.yPos=t.offsetTop,t.style.removeProperty("width"),t.style.removeProperty("height"),t.style.removeProperty("top"),t.style.removeProperty("left")),t.classList.toggle("fullscreen")},n.appendChild(o);var d=document.createElement("img");d.classList.add("appController"),d.alt="Minimize",d.src=this.imageFolder+"minimizewindow.png",d.onclick=function(){e.desktop.hideApp(this,e.imageFolder+"appIcons/"+e.type+"_Large.png")},n.appendChild(d),t.appendChild(n);var c=document.createElement("main");if("undefined"!=typeof this.contextMenu){var p=document.createElement("div");p.classList.add("Menu"),this.contextMenu().forEach(function(e){var t=e;t.classList.add("hide");var n=document.createElement("ul");n.classList.add("contextMenu");var i=document.createElement("a");i.href="#",i.innerHTML=t.dataset.name;var r=function(){t.classList.add("hide"),document.documentElement.removeEventListener("mouseup",r,!1)};i.onclick=function(e){e.preventDefault(),t.classList.remove("hide"),document.documentElement.addEventListener("mouseup",r,!1)},t.onclick=r,p.appendChild(n),n.appendChild(i),n.appendChild(t)}),c.appendChild(p)}if(this.app=document.createElement("div"),c.appendChild(this.app),t.appendChild(c),e.statusBar=document.createElement("footer"),e.statusBar.classList.add("statusBar"),t.appendChild(e.statusBar),this.resizable){var l,u,m,h,g=function(e){l=e.clientX,u=e.clientY,m=parseInt(document.defaultView.getComputedStyle(t).width,10),h=parseInt(document.defaultView.getComputedStyle(t).height,10),document.documentElement.addEventListener("mousemove",f,!1),document.documentElement.addEventListener("mouseup",v,!1)},f=function(e){m+e.clientX-l<window.innerWidth-300&&(t.style.minWidth=m+e.clientX-l+"px"),h+e.clientY-u<window.innerHeight-200&&(t.style.minHeight=h+e.clientY-u+"px")},v=function(){document.documentElement.removeEventListener("mousemove",f,!1),document.documentElement.removeEventListener("mouseup",v,!1)},w=document.createElement("img");w.alt="Resize",w.src=this.imageFolder+"resize.png",w.className="resize noselect",w.ondragstart=function(){return!1},w.addEventListener("mousedown",g,!1),t.appendChild(w)}document.querySelector("#desktopApplication").appendChild(t)},Window.prototype.setStatus=function(e){this.statusBar.innerHTML=e},Window.prototype.WindowConstruct=function(e,t,n,i,r){this.resizable=t,this.desktop=n,this.xPos=i,this.yPos=r,this.type=e,this.createHTML()},Window.prototype.DisableSelection=function(e){e.onselectstart=function(){return!1},e.unselectable="on",e.style.MozUserSelect="none",e.style.cursor="default"},Window.prototype.EnableSelection=function(e){e.onselectstart=function(){return!0},e.unselectable="off",e.style.MozUserSelect="text",e.style.cursor="auto"},window.onload=function(){new AppLoader("Loading your desktop..."),new Desktop("desktopApplication")};